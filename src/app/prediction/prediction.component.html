<div class="cosmos-viewport">
  <div class="galaxy-bg"></div>

  <header class="nexus-header">
    <h1 class="main-title">INTERESTELAR <span class="tagline">PREDICTOR ENGINE</span></h1>
    <div class="glow-line"></div>
  </header>

  <main class="ui-container">
    <div class="grid-layout" [class.expanded]="resultadoVisible">
      <section class="glass-card animate-border">

        <div class="power-control">
<button (click)="toggleSistema()" class="btn-power-dual" [class.is-on]="sistemaEncendido">
  <div class="power-labels">
    <span class="label-off" [class.active]="!sistemaEncendido">ENCENDER</span>
    <div class="separator"></div>
    <span class="label-on" [class.active]="sistemaEncendido">ONLINE</span>
  </div>
  <i class="power-icon">  <i class="power-icon"><i class="power-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-dot-icon lucide-circle-dot red-dot"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="1"/></svg></i></i> </i>
</button>
</div>

<div class="audio-control" (click)="toggleMusica()">
  <span class="sound-wave" [class.playing]="musicaActiva">
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
  </span>
  <span class="audio-label">{{ musicaActiva ? 'AUDIO ON' : 'AUDIO OFF' }}</span>
</div>

<div class="status-indicator" 
     [class.system-off]="!sistemaEncendido && !hayError"
     [class.is-error]="hayError">
     
  <span class="red-dot" 
        [class.active]="sistemaEncendido"
        [class.has-error]="hayError"></span>
  
  <span class="status-text">{{ mensajeEstado }}</span>
</div>
<h2 class="card-label" [class.active]="sistemaActivo">
     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-hard-drive-download-icon lucide-hard-drive-download"><path d="M12 2v8"/><path d="m16 6-4 4-4-4"/><rect width="20" height="8" x="2" y="14" rx="2"/><path d="M6 18h.01"/><path d="M10 18h.01"/></svg>  DATA_INPUT
  </h2>
  
  <div class="form-grid">
    <div class="input-group" [class.active]="sistemaEncendido && sistemaActivo">
  <label>NOMBRE DEL CLIENTE</label>
  <input type="text" 
         [(ngModel)]="cliente.name" 
         (focus)="activarSistema()" 
         [disabled]="!sistemaEncendido"
         class="starlight-input">
</div>
    <div class="input-group" [class.active]="sistemaEncendido && sistemaActivo">
      <label>ANTIGÜEDAD (MESES)</label>
      <input type="number" [(ngModel)]="cliente.tenure"
       (focus)="activarSistema()"
       [disabled]="!sistemaEncendido"
        class="starlight-input">
    </div>

    <div class="input-group" [class.active]="sistemaEncendido && sistemaActivo">
      <label>CARGO MENSUAL ($)</label>
      <input type="number"
       [(ngModel)]="cliente.monthly"
        (focus)="activarSistema()"
        [disabled]="!sistemaEncendido"
         class="starlight-input">
    </div>

    <div class="input-group" [class.active]="sistemaEncendido && sistemaActivo">
      <label>LLAMADAS AL SOPORTE TÉCNICO</label>
      <input type="number" 
      [(ngModel)]="cliente.calls" 
      (focus)="activarSistema()" 
      [disabled]="!sistemaEncendido"
      class="starlight-input">
    </div>
  </div>

   <button 
  (click)="ejecutarPrevision()" 
  class="btn-crystal-predict" 
  [disabled]="!sistemaEncendido"
  [class.system-off]="!sistemaEncendido">
    {{ analizando ? 'PROCESANDO...' : 'EJECUTAR SIMULACIÓN' }}
</button>
         
<div class="mt-6 flex justify-center" *ngIf="sistemaEncendido">
  <button 
    type="button"
    (click)="verLogs()"
    class="btn-crystal w-full animate-fade-in"
    [disabled]="analizando">
    <span class="flex items-center justify-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
      FINALIZAR Y VER LOG
    </span>
  </button>
</div>
      </section>

      <div class="glass-card result-card" *ngIf="resultadoVisible">
  <div class="flex justify-between items-center mb-4">
    <h3 class="text-cyan-400 font-bold text-xs tracking-[0.3em] uppercase">
      {{ mensajeTarjeta }}
    </h3>
    <span class="text-[13px] text-cyan-300/50 font-mono uppercase" *ngIf="nombreCapturado">
      ID: {{ nombreCapturado }}
    </span>
  </div>

  <div class="mb-6 p-4 bg-cyan-500/5 border border-cyan-500/20 rounded-lg animate-pulse" *ngIf="!analizando && cliente.name">
    <p class="text-[12px] text-cyan-400 uppercase mb-1">Resultado Pendiente de Registro</p>
    <div class="flex justify-between items-end">
       <span class="text-xl font-bold text-white">{{ (resultado.probability * 100).toFixed(1) }}%</span>
       <span class="text-[10px] font-bold" [ngClass]="getRiskClass()">{{ resultado.risk }}</span>
    </div>
  </div>

  <div class="custom-scrollbar overflow-y-auto max-h-[200px] pr-2">
  <table class="w-full text-left border-collapse">
    <tbody class="text-[13px]">
      <tr *ngFor="let log of historialLog" class="border-b border-white/5 hover:bg-cyan-400/5 transition-colors">
        <td class="py-3 text-cyan-100 font-mono">{{ log.nombre }}</td>
        <td class="py-3 text-white">{{ log.reco }}</td>
        <td class="py-3">
  <div class="flex items-center gap-2">
    <span *ngIf="log.color === 'red'">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#EB0C24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
    </span>

    <span *ngIf="log.color === 'yellow'">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#EBCA0C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
    </span>

    <span *ngIf="log.color === 'green'">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
    </span>

    <span [ngClass]="{
      'text-red-500': log.color === 'red',
      'text-yellow-500': log.color === 'yellow',
      'text-green-500': log.color === 'green'
    }" class="font-bold">
      {{ log.riesgo }}
    </span>
  </div>
</td>
      </tr>
      
      <tr *ngIf="historialLog.length === 0">
        <td colspan="3" class="py-4 text-center text-white-800 italic text-[12px]">
          SIN REGISTROS EN TELEMETRÍA
        </td>
      </tr>
    </tbody>
  </table>
</div>

  <button (click)="borrarLogs()" 
          *ngIf="historialLog.length > 0"
          class="mt-4 w-full text-[9px] text-gray-500 hover:text-red-400 transition-colors uppercase tracking-widest border border-dashed border-gray-800 py-2">
    [ Purgar Base de Datos ]
  </button>
</div>

     <!-- <div class="glass-card result-card" *ngIf="resultadoVisible">
  <h3 class="text-cyan-400 font-bold text-xs tracking-[0.3em] mb-4 uppercase">
    {{ mensajeTarjeta }}
  </h3>

  <div class="custom-scrollbar overflow-y-auto max-h-[250px] pr-2">
    <table class="w-full text-left border-collapse">
      <thead>
        <tr class="border-b border-cyan-900/50">
          <th class="py-2 text-[9px] text-gray-400 uppercase tracking-tighter">Sujeto</th>
          <th class="py-2 text-[9px] text-gray-400 uppercase tracking-tighter">Prob.</th>
          <th class="py-2 text-[9px] text-gray-400 uppercase tracking-tighter">Riesgo</th>
        </tr>
      </thead>
      <tbody class="text-[11px]">
        <tr *ngFor="let log of historialLog" class="border-b border-white/5 hover:bg-cyan-400/5 transition-colors">
          <td class="py-3 text-cyan-100 font-mono">{{ log.nombre }}</td>
          <td class="py-3 text-white">{{ log.prob }}</td>
          <td class="py-3">
            <span [ngClass]="{
              'text-red-500': log.riesgo.includes('CRÍTICO'),
              'text-yellow-500': log.riesgo.includes('MEDIO'),
              'text-green-500': log.riesgo.includes('BAJO')
            }" class="font-bold">
              {{ log.riesgo.split(':')[1] || log.riesgo }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <button (click)="borrarLogs()" class="mt-4 text-[9px] text-gray-500 hover:text-red-400 transition-colors uppercase tracking-widest">
    [ Purgar Base de Datos ]
  </button>
</div>-->

     <!-- <section class="glass-card result-card" *ngIf="resultadoVisible" 
               [class.alert-vibration]="resultado.probability > 0.7">

    <div class="result-header">
  <span class="tag-label">RESULTADO PARA:</span>
  <h2 class="client-name-display">*{{ nombreCapturado | uppercase }}</h2>
</div>

<div class="w-full bg-gray-800 rounded-full h-4 overflow-hidden border border-white/10">
  <div 
    class="h-full transition-all duration-1000 ease-out"
    [style.width.%]="resultado.probability * 100"
    [ngClass]="{
      'bg-green-500 shadow-[0_0_15px_#22c55e]': resultado.color === 'green',
      'bg-yellow-500 shadow-[0_0_15px_#eab308]': resultado.color === 'yellow',
      'bg-red-500 shadow-[0_0_15px_#ef4444]': resultado.color === 'red'
    }">
  </div>
</div>
        <div class="result-content" [ngClass]="getRiskClass()">
          <div class="status-icon-wrapper">
             <span class="status-glow"></span>
             <i class="status-text-icon">{{ getRiskIcon() }}</i>
          </div>
          
          <h3 class="result-status-title">{{ resultado.title}}</h3>
          <p class="result-desc">{{ resultado.reco }}</p>

          <div class="probability-container">
            <div class="bar-bg">
              <div class="bar-fill" [style.width.%]="resultado.probability * 100"></div>
            </div>
            <span class="prob-value">{{ (resultado.probability * 100).toFixed(1) }}% PROBABILIDAD</span>
          </div>

          <div class="risk-badge">{{ resultado.risk }}</div>
        </div>
      </section>-->

    </div>
  </main>
</div>